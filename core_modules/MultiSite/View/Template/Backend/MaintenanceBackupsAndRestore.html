<script type="text/javascript">
  function websiteRestoreCallbackJs(callback) {
      if ($J.trim(callback) !== '') {
          var params = {uploadedFilePath: callback[0]};
          $J.ajax({
              url: cx.variables.get('cadminPath', 'contrexx') + "?cmd=JsonData&object=MultiSite&act=checkUserStatusOnRestore",
              data: params,
              dataType: 'json',
              type: 'POST',
              success: function (response) {
                  var resp = (response.data) ? response.data : response;
                  if (resp.status === 'success') {
                    Multisite.websiteRestore(params, true, resp.userId ? resp.userId : 0);
                  }
              }
          });
      }
  }
  
  cx.ready(function () {
    $J('#serviceServerList').append(getEditOption('dropdown', 'serviceServer', 'serviceServer', '', cx.variables.get('serviceServers', 'multisite/lang')));
    cx.bind("userSelected", Multisite.showSubscriptionSelection, "user/live-search/restoreUserId");
    cx.bind("userCleared", function () {
        $J('#subscriptionSelection').hide();
        $J('#SubscriptionOption').hide();
        $J('#subscriptionSelection #subscriptionList').html('');
    }, "user/live-search/restoreUserId");
  });
</script>

<div id="instance_table">
  <form method="get" action="" name="websitebackupAndRestore" id="websitebackupAndRestore">
    <input type='hidden' name="cmd" value="MultiSite" />
    <input type='hidden' name="act" value="Maintenance/BackupsAndRestore" />
    <input type="hidden" name="show_all" value="1" />
    <table cellspacing="0" cellpadding="5" border="0" width="100%" class="adminlist" ><tr>
        <th valign="top" colspan="2">
      <div align="left">{FILTER}</div>
      </th></tr><tr><td>
          <input type="text" name="term" placeholder="{SEARCH_TERM}" id="term"  style="width: 300px;" class="search-box" value="" autocomplete="off" />
          &nbsp;&nbsp;
          <input type="submit" value="{SEARCH}"  id="searchButton"/>&nbsp;&nbsp;
        </td></tr>
    </table>
    {TABLE}
  </form>
  <br />
  <input type="button" value="{SHOWALL_BACKUPS_BUTTON}" id="showAll_backups" onclick="$J('#websitebackupAndRestore').submit();"/>&nbsp;
  {UPLOADER_CODE}

  <!--dialog box for restore website-->
  <div id="restoreWebsite" title="{TXT_CORE_MODULE_MULTISITE_WEBSITE_RESTORE}" style="display: none;">
    <form id="restoreWebsiteForm" >
      <span id="restoreform_error" >{TXT_CORE_MODULE_MULTISITE_WEBSITE_FIELD_REQUIRED}</span>
      <table id="MultisiteWebsiteRestore" class="adminlist" cellspacing = "0" cellpadding = "3" width = "100%">
        <tr>
          <td width="40%">
            <label><strong>{TXT_CORE_MODULE_MULTISITE_CHOOSE_SERVICE_SERVER}&nbsp;<span class="mandatory">*</span></strong></label>
          </td>
          <td width="60%">
            <div id="serviceServerList"></div>
          </td>
        </tr>
        <tr>
          <td>
            <label><strong>{TXT_CORE_MODULE_MULTISITE_ENTER_WEBSITE_NAME}&nbsp;<span class="mandatory">*</span></strong></label>
          </td>
          <td>
            <div id="restore_websiteName" >
              <input type="text" name="restoreWebsiteName" id ="restoreWebsiteName"  class="restoreWebsiteName"/>
              <div class="restoreWebsiteName">.{MULTISITE_DOMAIN}</div>
              <span class="restore_error">{TXT_CORE_MODULE_MULTISITE_WEBSITE_NAME_ERROR}</span>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <label><strong>{TXT_CORE_MODULE_MULTISITE_CHOOSE_USER}&nbsp;<span class="mandatory">*</span></strong></label>
          </td>
          <td id="userSelection">
            <label> <input type="radio" name="selectUserType"  checked = "checked" onchange = "Multisite.showUserOrSubscriptionSelection()" value = "1" required="" class = "selectUserType" id="createUserFromBackup"/> <strong>{TXT_CORE_MODULE_MULTISITE_CREATE_BACKUP_USER}</strong> <br/> </label> 
            <label> <input type="radio" name="selectUserType" required="" value = "2"  onchange = "Multisite.showUserOrSubscriptionSelection()" class = "selectUserType" id="selectUserFromOther"/> <strong>{TXT_CORE_MODULE_MULTISITE_CHOOSE_ANOTHER_USER}</strong> <br/> </label> 
            <input class="live-search-user-id" id="restoreUserId" type="hidden" name="restoreUserId" value="" />
            <input class="live-search-user-name" id="restoreUserName" type="hidden" name="restoreUserName" value="" placeholder="{TXT_CORE_SEARCH_USER}..." style="width: 277px;" />
            <span class="restore_error">Please select the user.</span>
          </td>
        </tr>
        <tr id="SubscriptionOption">
          <td>
            <label><strong>{TXT_CORE_MODULE_MULTISITE_CHOOSE_SUBSCRIPTION}&nbsp;<span class="mandatory">*</span></strong></label>
          </td>
          <td id="Subscription">
            <label> <input type="radio" name="subscription"  checked  id ="createNewSubscription" onchange = "Multisite.showUserOrSubscriptionSelection(null, 'subscriptionOption')" value = "1" /> <strong>{TXT_CORE_MODULE_MULTISITE_CREATE_NEW_SUBSCRIPTION}</strong> <br/> </label> 
            <label> <input type="radio" name="subscription" id ="useExistingSubscription" onchange = "Multisite.showUserOrSubscriptionSelection(null, 'subscriptionOption')" value = "2"  /> <strong>{TXT_CORE_MODULE_MULTISITE_USE_EXISTING_SUBSCRIPTION}</strong> <br/> </label> 
          </td>
        </tr>
        <tr id="subscriptionSelection">
          <td>
            <label><strong>{TXT_MULTISITE_WEBSITE_SUBSCRIPTION}</strong></label>
          </td>
          <td >
            <div id="subscriptionList"></div>
          </td>
        </tr>
      </table>
    </form>
  </div>
</div>
