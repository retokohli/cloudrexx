<script type="text/javascript">
/* <![CDATA[ */
jQuery(document).ready(function(){
    if (typeof(cx_multisite_options) == 'undefined') {
        cx_multisite_options = {};
    }
    var options = {
        email: '',
        address: '',
        signUpUrl: '{MULTISITE_SIGNUP_URL}',
        emailUrl: '{MULTISITE_EMAIL_URL}',
        addressUrl: '{MULTISITE_ADDRESS_URL}',
        multisiteDomain: '{MULTISITE_DOMAIN}',
        headerInitTxt: '{TITLE}',
        headerSetupTxt: '{TXT_MULTISITE_BUILD_WEBSITE_TITLE} <img src="{MULTISITE_PATH}/lib/javascript/jquery/jstree/themes/default/throbber.gif" />',
        headerSuccessTxt: '{TXT_MULTISITE_BUILD_SUCCESSFUL_TITLE}',
        headerErrorTxt: '{TXT_MULTISITE_BUILD_ERROR_TITLE}',
        messageErrorTxt: '{TXT_MULTISITE_BUILD_ERROR_MSG}',
        messageBuildTxt: '{TXT_MULTISITE_BUILD_WEBSITE_MSG}',
        messageRedirectTxt: '{TXT_MULTISITE_REDIRECT_MSG}'
    };
    for (var option in options) {
        if (!cx_multisite_options[option]) {
            cx_multisite_options[option] = options[option];
        }
    }
    jQuery.getScript("{MULTISITE_PATH}/lib/javascript/jquery/bootstrapvalidator/js/bootstrapValidator.min.js", function() {
        jQuery.getScript('https://media.payrexx.com/modal/v1/modal.js', function() {
            jQuery.getScript('{MULTISITE_PATH}/core_modules/MultiSite/View/Script/SignUp.js');
        });        
    });

});

var validateAdress = function (value, validator, $field) {
    var message = '';
    if (!value.match(/^[a-z0-9]+$/)) {
        message +=  'Im Domainnamen dÃ¼rfen nur Kleinbuchstaben und Zahlen vorkommen.';
    }
    if (jQuery($field).data('server-msg') != true && jQuery($field).data('server-msg')){
        message +=   jQuery($field).data('server-msg') ;
    }
    if (message != ''){
        return {
            valid: false,
            message: message
        };
    }
    return true;
};

var validateEmail = function (value, validator, $field) {
    var message = '';
    if (jQuery($field).data('server-msg') !== true && jQuery($field).data('server-msg')){
        message +=  jQuery($field).data('server-msg') ;
    }
    if (message != ''){
        return {
            valid: false,
            message: message
        };
    }
    return true;
};
/* ]]> */
</script>
<style type="text/css">
/* <![CDATA[ */
.multisite-status,
.multisite-progress {
    display: none;
}
/* ]]> */
</style>
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{TXT_MULTISITE_CLOSE}</span></button>
        <h4 class="modal-title">{TITLE}</h4>
    </div>
    <div class="modal-body multisite-status"></div>

    <div class="modal-body multisite-form">
        <!-- TODO is form required ?? -->
        <form id="multisite_signup_form" role="form" >
            <div class="alert alert-success" role="alert">
                {PRODUCT_NOTE_ENTITY}
            </div>
            <input type="hidden" id="product_id" name="product_id" value="{PRODUCT_ID}">
            <input type="hidden" id="product_name" value="{PRODUCT_NAME}">
            <input type="hidden" id="multisite_domain" value="{MULTISITE_DOMAIN}">
            <div class="form-group">
                <input  data-bv-callback="true" data-bv-callback-callback="validateEmail"  data-bv-notempty="true"
                        data-bv-notempty-message="{TXT_MULTISITE_EMAIL_INFO}"
                        data-bv-emailaddress="true"
                        data-bv-emailaddress-message=" "  id="multisite_email_address" name="multisite_email_address" type="email" class="form-control" title="{TXT_MULTISITE_EMAIL_INFO}" placeholder="{TXT_MULTISITE_EMAIL_ADDRESS}" required="">
            </div>

            <div class="form-group">
                <div class="input-group multisite-address">
                    <input  data-bv-notempty="true" data-bv-notempty-message=" " data-bv-callback="true" data-bv-callback-callback="validateAdress"  id="multisite_address" name="multisite_address" type="text" title="{TXT_MULTISITE_SITE_ADDRESS_SCHEME}" class="form-control" value="{MULTISITE_ADDRESS}" placeholder="{TXT_MULTISITE_ADDRESS}" required="">
                    <div class="input-group-addon">.{MULTISITE_DOMAIN}</div>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label"></label>

                    <div class="checkbox">
                        <label>
                            <input data-bv-notempty="true"
                                   data-bv-message="{TXT_MULTISITE_ACCEPT_TERMS_ERROR}" id="multisite_terms" name="agb" type="checkbox" required=""/> {TXT_MULTISITE_ACCEPT_TERMS}
                        </label>
                    </div>
            </div>
        </form>
    </div>

    <div class="modal-body multisite-progress">
        <div></div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-default multisite_close" data-dismiss="modal">{TXT_MULTISITE_CLOSE}</button>
        <button type="button" class="btn btn-default multisite_cancel" data-dismiss="modal">Abbrechen{TXT_MULTISITE_CANCEL}</button>
        <button type="button" class="btn btn-primary multisite_submit">{TXT_MULTISITE_CREATE_WEBSITE}</button>
        <button type="button" class="btn btn-primary multisite_pay" data-href="{MULTISITE_OPTION_PAYREXXFORMURL}">{TXT_MULTISITE_ORDER_NOW}</button>
    </div>
