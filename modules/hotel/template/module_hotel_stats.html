<!-- START module_hotel_stats.html -->
<script type="text/javascript" src="../lib/datepickercontrol/datepickercontrol.js">
</script>

<script type="text/javascript">
//<![CDATA[

    function deleteContact(contactID) {
    	strConfirmTxt = '{TXT_HOTEL_CONFIRM_DELETE_CONTACT}';
    	if (confirm(strConfirmTxt+'\n{TXT_HOTEL_CANNOT_UNDO_OPERATION}')) {
    		window.location.href = "?cmd=hotel&{CSRF_PARAM}&act=stats&del="+contactID;
    	}
    }

    /*
	 Tooltip stuff
	 */
    var Style = new Array();
    var Text = new Array();
	Style[0]=["","","","","",,"black","#ffffe1","","","",,,,1,"#000000",2,21,0.3,,2,"gray",1,,15,-5];
    <!-- BEGIN commentsArray -->
	Text[{HOTEL_COMMENT_INDEX}]=["","{HOTEL_COMMENT_TEXT}"];<!-- END commentsArray -->

	/**
	 *  DOM sorting
	 *	remote script by savino
	 *	(c) 2006, ASTALAVISTA IT Engineering
	 */
	var http;
	var request_active = false;
	var requests	= new Array();
	var contacts 	= new Array();
	var interests	= new Array();
	var fields 		= new Array();
	var timespan	= "";

	fields[0] 	= new Array('visits', 'reference', 'ref_note', 'header', 'location');
	fields[1] 	= new Array('dl_count', 'dl_reference', 'dl_ref_note', 'dl_header', 'dl_linkname');
	fields[2] 	= new Array('int_count', 'int_reference', 'int_ref_note', 'int_header');

	var clearArrows = function(index){
		for (i=0; i<fields[index].length; i++){
			document.getElementById(fields[index][i]+"_order").innerHTML = '';
		}
	}

	if (document.ELEMENT_NODE == null) {
	  document.ELEMENT_NODE = 1;
	  document.TEXT_NODE = 3;
	}

	function getXMLHttpRequestObj() {
	  var objXHR;
	  if(window.XMLHttpRequest) {
	      objXHR = new XMLHttpRequest();
	  } else if(window.ActiveXObject) {
	      objXHR = new ActiveXObject("Microsoft.XMLHTTP");
	  }
	  return objXHR;
	}

	http = getXMLHttpRequestObj();

	function sendReq(field, type) {
		if(request_active){
			return false;
		}else{
			request_active = true;
		}
		limit 			= document.getElementById("paging_limit").value;
		pos 			= document.getElementById("paging_pos").value;
		orderspan 		= document.getElementById(field+"_order");
		searchField		= document.getElementById("hsearchField").value;
		search 			= document.getElementById("hsearch").value;
		hfield 			= document.getElementById("field");
		hfield.value 	= field;
		if(orderspan.order == 'asc'){
			orderspan.order = 'desc';
		}else if(orderspan.order == 'desc'){
			orderspan.order = 'asc';
		}else{
			orderspan.order = 'asc';
		}
		clearArrows(type);
		if (orderspan.order == 'asc'){
			orderspan.innerHTML = '\u2191';
		}else{
			orderspan.innerHTML = '\u2193';
		}


		if(document.getElementById("ignore_timespan").checked){
			timespan="on";
		}else{
			timespan="";
		}

		if(type == 0){
			http.open('get', '?cmd=hotel&act=rpcr&field='+field+'&order='+orderspan.order+'&limit='+limit+'&pos='+pos+'&ignore_timespan='+timespan);
			http.onreadystatechange = updateStatsList
		}else if (type == 1){
			http.open('get', '?cmd=hotel&act=rpcdl&field='+field+'&order='+orderspan.order+'&limit='+limit+'&pos='+pos+'&ignore_timespan='+timespan);
			http.onreadystatechange = updateDownloadList
		}else if (type == 2){
			http.open('get', '?cmd=hotel&act=rpcsi&field='+field+'&order='+orderspan.order+'&limit='+limit+'&pos='+pos+'&ignore_timespan='+timespan);
			http.onreadystatechange = updateInterestList
		}else{
		}
	    http.send(null);
	}

	function createTdWithText(text){
		td = document.createElement("td");
		td.style.whiteSpace = 'nowrap';
		text = (text == '') ? ' ' : text;
		textNode = document.createTextNode(text);
		td.appendChild(textNode);
		return td;
	}

	function updateDownloadList() {
	    if(http.readyState == 4 && http.status == 200){
	    	requests = new Array();
	        var response = http.responseText;
	        eval(response); // create contacts array
	        tbl = document.getElementById('downloadlist');
				tBody = tbl.tBodies[0];
				for(i = tBody.childNodes.length-1; i>=0; i--){
	            	try{
	            		bin = tBody.removeChild(tBody.childNodes[i]);
	            	}catch(e){}
	            }
	            for(i in requests){
	            	row = document.createElement("tr");
	            	row.className = 'row' + ((i%2) + 1);
        			row.appendChild(createTdWithText(unescape(requests[i].dl_count)));
        			aOpen = document.createElement("a");
					aOpen.href = '?cmd=hotel&act=downloads&id='+requests[i].dl_hotelid;
					aOpen.title = '{TXT_HOTEL_SHOW_TIMESPAN_DETAILS}';
	            	aOpen.appendChild(document.createTextNode(unescape(requests[i].dl_reference)));
	            	pageTD = document.createElement("td");
	            	pageTD.appendChild(aOpen);
	            	row.appendChild(pageTD);
	            	row.appendChild(createTdWithText(unescape(requests[i].dl_ref_note)));
	            	row.appendChild(createTdWithText(unescape(requests[i].dl_header)));
	            	row.appendChild(createTdWithText(unescape(requests[i].dl_linkname)));
					tBody.appendChild(row);
	            }
           		request_active = false;
        }else{
        	try{
	        	if(http.statusText == 'OK'){
	        		return false;
	        	}else{
		        	alert('error: ' + http.statusText);
	        	}
        	}catch(e){}
        }
    }

    function updateInterestList(){
    	if(http.readyState == 4 && http.status == 200){
	    	requests = new Array();
	        var response = http.responseText;
	        eval(response); // create contacts array
	        tbl = document.getElementById('interestlist');
				tBody = tbl.tBodies[0];
				for(i = tBody.childNodes.length-1; i>=0; i--){
	            	try{
	            		bin = tBody.removeChild(tBody.childNodes[i]);
	            	}catch(e){}
	            }
	            for(i in interests){
	            	row = document.createElement("tr");
	            	row.className = 'row' + ((i%2) + 1);
        			row.appendChild(createTdWithText(unescape(interests[i].int_count)));
        			aOpen = document.createElement("a");
					aOpen.href = '?cmd=hotel&act=interests&id='+interests[i].int_hotelid;
					aOpen.title = '{TXT_HOTEL_SHOW_TIMESPAN_DETAILS}';
	            	aOpen.appendChild(document.createTextNode(unescape(interests[i].int_reference)));
	            	pageTD = document.createElement("td");
	            	pageTD.appendChild(aOpen);
	            	row.appendChild(pageTD);
	            	row.appendChild(createTdWithText(unescape(interests[i].int_ref_note)));
	            	row.appendChild(createTdWithText(unescape(interests[i].int_header)));
					tBody.appendChild(row);
	            }
           		request_active = false;
        }else{
        	try{
	        	if(http.statusText == 'OK'){
	        		return false;
	        	}else{
		        	alert('error: ' + http.statusText);
	        	}
        	}catch(e){}
        }

    }

	function updateStatsList() {
	    if(http.readyState == 4 && http.status == 200){
	        contacts = new Array();
	    	var response = http.responseText;
	        eval(response); // create requests array
	        tbl = document.getElementById('statslist');
				tBody = tbl.tBodies[0];
				for(i = tBody.childNodes.length-1; i>=0; i--){
	            	try{
	            		bin = tBody.removeChild(tBody.childNodes[i]);
	            	}catch(e){}
	            }
	            for(i in requests){
	            	row = document.createElement("tr");
	            	row.className = 'row' + ((i%2) + 1);
	            	row.appendChild(createTdWithText(unescape(requests[i].visits)));
        			aOpen = document.createElement("a");
					aOpen.href = unescape(requests[i].page);
					aOpen.title = 'open';
					aOpen.target = '_blank';
	            	aOpen.appendChild(document.createTextNode((requests[i].reference != '') ? unescape(requests[i].reference) : 'N/A') );
	            	pageTD = document.createElement("td");
	            	pageTD.appendChild(aOpen);
	            	row.appendChild(pageTD);
	            	row.appendChild(createTdWithText((requests[i].ref_note != '') ? unescape(requests[i].ref_note) : 'N/A'));
	            	row.appendChild(createTdWithText((requests[i].header != '') ? unescape(requests[i].header) : 'N/A'));
	            	row.appendChild(createTdWithText((requests[i].location != '') ? unescape(requests[i].location) : 'N/A'));
					tBody.appendChild(row);
	            }
		  		request_active = false;
        }else{
        	try{
	        	if(http.statusText == 'OK'){
	        		return false;
	        	}else{
		        	alert('error: ' + http.statusText);
	        	}
        	}catch(e){}
        }
    }


	DatePickerControl.onSelect = function(inputid){
	  var startdate = document.getElementById("DPC_edit1_YYYY-MM-DD").value.replace(/-/g, "");
	  var enddate = document.getElementById("DPC_edit2_YYYY-MM-DD").value.replace(/-/g, "");

	  if (startdate > enddate) {
	  	var date = document.getElementById("DPC_edit1_YYYY-MM-DD").value;
	  	document.getElementById("DPC_edit2_YYYY-MM-DD").value = date;
	  }
	}



    function getTimestampFromDate(strDate, seperator){
    	parts 		= strDate.split(seperator);
		newDate 	= new Date(parts[0], parts[1]-1, parts[2]);
		timestamp 	= newDate.getTime()+"";
		return Math.floor(timestamp / 1000);
    }


    function setFormAction(formAction){
    	document.getElementById("hotelstatsform").action = formAction;
    }

    function selectTab2(tab){
    	document.getElementById('visibleTab').value = tab;
    	selectTab(tab);
    }

//]]>

</script>

<form action="index.php?cmd=hotel&amp;act=stats" id="hotelstatsform" method="post">
<table border="0" cellspacing="0" class="adminlist" style="width: 100%" cellpadding="3">
	<tr>
		<th>
			{TXT_HOTEL_TIMESPAN}
		</th>
	</tr>
	<tr>
		<td>
		  <!-- datepickercontrol options -->
			<input type="hidden" id="DPC_TODAY_TEXT" value="heute" />
			<input type="hidden" id="DPC_BUTTON_TITLE" value="Kalender ï¿½ffnen..." />
			<input type="hidden" id="DPC_MONTH_NAMES" value="['Januar', 'Februar', 'M&auml;rz', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember']" />
			<input type="hidden" id="DPC_DAY_NAMES" value="['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa']" />
			<!-- /datepickercontrol options -->

			<div id="datepick">
				{TXT_HOTEL_FROM} <input type="text" name="inputStartDate" id="DPC_edit1_YYYY-MM-DD" value="{CALENDAR_TODAY}" style="width: 8em; padding: 2px;" />
				{TXT_HOTEL_TO} <input type="text" name="inputEndDate" id="DPC_edit2_YYYY-MM-DD" value="{CALENDAR_NEXT_MONTH}" style="width: 8em; padding: 2px;" />
				<input type="checkbox" id="ignore_timespan" name="ignore_timespan" {HOTEL_IGNORE_TIMESPAN_CHECKED} /> {TXT_HOTEL_IGNORE_TIMESPAN}
				<input type="submit" name="show_entries_in_timespan" value="{TXT_HOTEL_REFRESH}" />
			</div>
		</td>
	</tr>
</table>


<br />
<!-- START Tabmenu -->
<!--
<ul id="tabmenu">
<li><a id="editorTab_hotel_downloads" href="javascript:void(0)" {HOTEL_DOWNLOADS_TAB_ACTIVE} onclick="selectTab2('hotel_downloads')" title="{TXT_HOTEL_DOWNLOADS}">{TXT_HOTEL_DOWNLOADS}</a></li>
<li><a id="editorTab_hotel_interests" href="javascript:void(0)" {HOTEL_INTERESTS_TAB_ACTIVE} onclick="selectTab2('hotel_interests')" title="{TXT_HOTEL_INTERESTS}">{TXT_HOTEL_INTERESTS}</a></li>
<li><a id="editorTab_hotel_pageviews" href="javascript:void(0)" {HOTEL_PAGEVIEWS_TAB_ACTIVE} onclick="selectTab2('hotel_pageviews')" title="{TXT_HOTEL_PAGE_VIEWS}">{TXT_HOTEL_PAGE_VIEWS}</a></li>
</ul>
-->
<!-- END Tabmenu -->

<!-- START pageViews form -->
<div class="editorTab" id="hotel_pageviews" {HOTEL_PAGEVIEWS_VISIBLE}>
<!--<form action="?cmd=hotel&amp;act=stats" method="post">-->
<table border="0" id="statslist" cellspacing="0" class="adminlist" style="width: 100%" cellpadding="3">
<thead>
<tr>
	<th colspan="5">{TXT_HOTEL_PAGE_VIEWS}</th>
</tr>
<tr class="row3">
		<td style="white-space: nowrap; width: 10%;"><a id="visits" href="javascript:void(0);" onclick="sendReq('visits', 0);"><strong>{TXT_HOTEL_COUNT}</strong></a>
		<span id="visits_order"> </span>
	</td>
	<td><a id="page" href="javascript:void(0);" onclick="sendReq('reference', 0);"><strong>{TXT_HOTEL_REFERENCE_NUMBER}</strong></a>
		<span id="reference_order"> </span>
	</td>
		<td><a id="page" href="javascript:void(0);" onclick="sendReq('ref_note', 0);"><strong>{TXT_HOTEL_REF_NOTE}</strong></a>
		<span id="ref_note_order"> </span>
	</td>
	<td><a id="header" href="javascript:void(0);" onclick="sendReq('header', 0);"><strong>{TXT_HOTEL_HEADER}</strong></a>
		<span id="header_order"> </span>
	</td>
	<td><a id="location" href="javascript:void(0);" onclick="sendReq('location', 0);"><strong>{TXT_HOTEL_LOCATION}</strong></a>
		<span id="location_order"> </span>
	</td>

</tr>
</thead>
<tbody>
<!-- BEGIN pageVisits -->
<tr class="{ROW_CLASS}">
	<td style="white-space: nowrap; width: 10%;">{HOTEL_VISITS}</td>
	<td><a target="_blank" href="{HOTEL_OBJECT_NAME}" title="{TXT_HOTEL_SHOW_OBJECT_IN_NEW_WINDOW}">{HOTEL_OBJECT_REFERENCE}</a></td>
	<td>{HOTEL_OBJECT_REF_NOTE}</td>
	<td>{HOTEL_OBJECT_HEADER}</td>
	<td>{HOTEL_OBJECT_LOCATION}</td>
</tr>
<!-- END pageVisits -->
</tbody>
</table>
<!--</form>-->
<br />
{HOTEL_STATS_PAGEVIEW_PAGING}
</div>
<input type="hidden" id="paging_limit" name="paginglimit" value="{HOTEL_PAGING_LIMIT}" />
<input type="hidden" id="paging_pos" name="paginglimit" value="{HOTEL_PAGING_POS}" />
<input type="hidden" id="field" name="field" value="{HOTEL_PAGING_FIELD}" />
<!-- END pageViews form -->


<div class="editorTab" id="hotel_downloads" style="display: none;">
<!--<form action="?cmd=hotel&amp;act=downloads" method="post">-->
<table  border="0" cellspacing="0" class="adminlist" style="width: 100%" cellpadding="3">
<tr>
	<th>
		<span style="float: right; margin-right: 10px;">{TXT_HOTEL_EXPORT}</span>{TXT_HOTEL_DOWNLOAD_SEARCH}
	</th>
</tr>
<tr>
<td>


<div style="float: right;">
	<a href="?cmd=hotel&amp;act=export&amp;type=downloads"> <img style="vertical-align: middle; border: 0;" src="images/icons/excel.gif" title="export" alt="export" /> {TXT_HOTEL_DOWNLOAD_LIST}</a>
</div>


<input name="search" type="text" value="" />
<select name="searchField">
	<option value="email">{TXT_HOTEL_EMAIL}</option>
	<option value="name">{TXT_HOTEL_NAME}</option>
	<option value="firstname">{TXT_HOTEL_FIRSTNAME}</option>
	<option value="company">{TXT_HOTEL_COMPANY}</option>
	<option value="street">{TXT_HOTEL_STREET}</option>
	<option value="location">{TXT_HOTEL_LOCATION}</option>
</select>
<input type="submit" value="{TXT_HOTEL_SEARCH}" onclick="setFormAction('?cmd=hotel&act=downloads');" />
</td>
</tr>
<tr><td></td></tr>
</table>
<!--</form>
<form action="?cmd=hotel&amp;act=stats" method="post">-->
<table id="downloadlist" border="0" cellspacing="0" class="adminlist" style="width: 100%" cellpadding="3">
<thead>
<tr>
	<th colspan="5">{TXT_HOTEL_DOWNLOADS}</th>
</tr>
<tr class="row3">
	<td><a id="dl_count" href="javascript:void(0);" onclick="sendReq('dl_count', 1);"><strong>{TXT_HOTEL_COUNT}</strong></a>
		<span id="dl_count_order"> </span>
	</td>
	<td><a id="dl_reference" href="javascript:void(0);" onclick="sendReq('dl_reference', 1);"><strong>{TXT_HOTEL_REFERENCE_NUMBER}</strong></a>
		<span id="dl_reference_order"> </span>
	</td>
	<td><a id="dl_ref_note" href="javascript:void(0);" onclick="sendReq('dl_ref_note', 1);"><strong>{TXT_HOTEL_REF_NOTE}</strong></a>
		<span id="dl_ref_note_order"> </span>
	</td>
	<td><a id="dl_header" href="javascript:void(0);" onclick="sendReq('dl_header', 1);"><strong>{TXT_HOTEL_HEADER}</strong></a>
		<span id="dl_header_order"> </span>
	</td>
	<td><a id="dl_linkname" href="javascript:void(0);" onclick="sendReq('dl_linkname', 1);"><strong>{TXT_HOTEL_LINKNAME}</strong></a>
		<span id="dl_linkname_order"> </span>
	</td>

</tr>
</thead>
<tbody>
<!-- BEGIN downloads -->
<tr class="{ROW_CLASS}">
	<td>{HOTEL_DL_COUNT}&nbsp;</td>
	<td><a href="?cmd=hotel&amp;act=downloads&amp;id={HOTEL_DL_HOTEL_ID}" title="{TXT_HOTEL_SHOW_TIMESPAN_DETAILS}">{HOTEL_DL_REFERENCE}</a>&nbsp;</td>
	<td>{HOTEL_DL_REF_NOTE}&nbsp;</td>
	<td>{HOTEL_DL_HEADER}&nbsp;</td>
	<td>{HOTEL_DL_LINKNAME}&nbsp;</td>
</tr>
<!-- END downloads -->
</tbody>
</table>
<input type="hidden" id="hsearchField" name="paginglimit" value="{HOTEL_HSEARCH_FIELD}" />
<input type="hidden" id="hsearch" name="field" value="{HOTEL_HSEARCH}" />
<!--</form>-->
<br />
{HOTEL_STATS_DOWNLOADS_PAGING}
</div>
<!-- END documentViews form -->


<div class="editorTab" id="hotel_interests">

<table  border="0" cellspacing="0" class="adminlist" style="width: 100%" cellpadding="3">
<tr>
	<th>
		<span style="float: right; margin-right: 10px;">{TXT_HOTEL_EXPORT}</span>{TXT_HOTEL_INTEREST_SEARCH}
	</th>
</tr>
<tr>
<td>


<div style="float: right;">
	<a href="?cmd=hotel&amp;act=export&amp;type=interests"> <img style="vertical-align: middle; border: 0;" src="images/icons/excel.gif" title="export" alt="export" /> {TXT_HOTEL_DOWNLOAD_LIST}</a>
</div>


<input name="search" type="text" value="" />
<select name="searchField">
	<option value="email">{TXT_HOTEL_EMAIL}</option>
	<option value="name">{TXT_HOTEL_NAME}</option>
	<option value="firstname">{TXT_HOTEL_FIRSTNAME}</option>
	<option value="company">{TXT_HOTEL_COMPANY}</option>
	<option value="street">{TXT_HOTEL_STREET}</option>
	<option value="location">{TXT_HOTEL_LOCATION}</option>
</select>
<input type="submit" value="{TXT_HOTEL_SEARCH}" onclick="setFormAction('?cmd=hotel&act=interests');" />
</td>
</tr>
<tr><td></td></tr>
</table>

<table id="interestlist" border="0" cellspacing="0" class="adminlist" style="width: 100%" cellpadding="3">
<thead>
<tr>
	<th colspan="5">{TXT_HOTEL_INTERESTS}</th>
</tr>
<tr class="row3">
	<td><a id="dl_count" href="javascript:void(0);" onclick="sendReq('int_count', 2);"><strong>{TXT_HOTEL_COUNT}</strong></a>
		<span id="int_count_order"> </span>
	</td>
	<td><a id="dl_reference" href="javascript:void(0);" onclick="sendReq('int_reference', 2);"><strong>{TXT_HOTEL_REFERENCE_NUMBER}</strong></a>
		<span id="int_reference_order"> </span>
	</td>
	<td><a id="dl_ref_note" href="javascript:void(0);" onclick="sendReq('int_ref_note', 2);"><strong>{TXT_HOTEL_REF_NOTE}</strong></a>
		<span id="int_ref_note_order"> </span>
	</td>
	<td><a id="dl_header" href="javascript:void(0);" onclick="sendReq('int_header', 2);"><strong>{TXT_HOTEL_HEADER}</strong></a>
		<span id="int_header_order"> </span>
	</td>
<!--	<td><a id="dl_linkname" href="javascript:void(0);" onclick="sendReq('dl_linkname', 1);"><strong>{TXT_HOTEL_LINKNAME}</strong></a>
		<span id="dl_linkname_order"> </span>
	</td>-->
</tr>
</thead>
<tbody>
<!-- BEGIN interests -->


<tr class="{ROW_CLASS}">
	<td>{HOTEL_INTEREST_COUNT}&nbsp;</td>
	<td><a href="?cmd=hotel&amp;act=interests&amp;id={HOTEL_INTEREST_HOTEL_ID}" title="{TXT_HOTEL_SHOW_TIMESPAN_DETAILS}">{HOTEL_INTEREST_REFERENCE}</a>&nbsp;</td>
	<td>{HOTEL_INTEREST_REF_NOTE}&nbsp;</td>
	<td>{HOTEL_INTEREST_HEADER}&nbsp;</td>
	<!--<td>{HOTEL_INTEREST_LINKNAME}&nbsp;</td>-->
</tr>
<!-- END interests -->
</tbody>
</table>
<input type="hidden" id="visibleTab" name="tab" value="{HOTEL_VISIBLE_TAB}" />
</form>
<br />
{HOTEL_STATS_INTERESTS_PAGING}

</div>
<br />
<!-- END module_hotel_stats.html -->
